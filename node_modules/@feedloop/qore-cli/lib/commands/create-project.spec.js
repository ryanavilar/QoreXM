"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const nock_record_1 = require("nock-record");
const fs_extra_1 = tslib_1.__importDefault(require("fs-extra"));
const path_1 = tslib_1.__importDefault(require("path"));
const create_project_1 = tslib_1.__importDefault(require("./create-project"));
const config_1 = tslib_1.__importDefault(require("../config"));
const record = nock_record_1.setupRecorder();
const projectName = "qore-project-test";
describe("create-project", () => {
    beforeEach(() => {
        config_1.default.reset("org", "project", "token");
    });
    afterAll(() => {
        fs_extra_1.default.removeSync(path_1.default.resolve(process.cwd(), projectName));
    });
    it("should be able to export schema", async () => {
        process.env.QORE_SERVER =
            "https://p-qore-dot-pti-feedloop.et.r.appspot.com";
        const { completeRecording } = await record("create-project");
        await create_project_1.default.run([
            "--org",
            "lIdfC42DJCN2XzQ",
            "--token",
            "3960f3b8-a139-42eb-8295-3d669e4da4c9",
            projectName
        ]);
        const qoreConfig = await fs_extra_1.default.readJson(path_1.default.resolve(process.cwd(), projectName, "qore.config.json"));
        expect(qoreConfig).toMatchSnapshot();
        await expect(create_project_1.default.run([
            "--org",
            "lIdfC42DJCN2XzQ",
            "--token",
            "3960f3b8-a139-42eb-8295-3d669e4da4c9",
            "--template",
            "some-unknown-template",
            projectName
        ])).rejects.toThrowError('Cant find "some-unknown-template" from project templates, may want to choose from the following available templates: todo-list-typescript');
        completeRecording();
    });
});
