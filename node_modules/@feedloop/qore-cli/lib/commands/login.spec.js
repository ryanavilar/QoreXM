"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const prompts_1 = tslib_1.__importDefault(require("prompts"));
const nock_record_1 = require("nock-record");
const login_1 = tslib_1.__importDefault(require("./login"));
const config_1 = tslib_1.__importDefault(require("../config"));
const record = nock_record_1.setupRecorder();
describe("login", () => {
    beforeEach(() => {
        config_1.default.reset("org", "project", "token");
    });
    it("authenticate user", async () => {
        process.env.QORE_SERVER =
            "https://p-qore-dot-pti-feedloop.et.r.appspot.com";
        const stdoutSpy = jest.spyOn(process.stdout, "write");
        prompts_1.default.inject(["rama@feedloop.io", "123"]);
        const { completeRecording } = await record("login");
        await login_1.default.run([]);
        expect(stdoutSpy).toHaveBeenCalledWith("Logged in as rama@feedloop.io\n");
        completeRecording();
    });
});
